---
title: "Constructing a Win Probability Model"
author: "Derrick Yam"
date: "December 14, 2017"
output: html_document
---

##Load Libraries
```{r}
library(rvest)
library(pipeR)
library(knitr)
library(xml2)
library(htmltab)
library(readxl)
library(tidyr)
library(lubridate)
library(dplyr)
library(stringr)
library(tibble)
library(XML)
options(tibble.width = Inf)
```

##Call functions from the other script files

##Pull in Overall Schedules
```{r}

Seas2018 <- schedule_table("2018")
Seas2017 <- schedule_table("2017")
load("C:/Users/dyam/Dropbox (Brown)/Brown/Statistical Programming/r-package-teamivy/NBAStats/R/sysdata.rda")

GetTeamSchedule("Boston Celtics", Year = "2018")

```

##teamrankings.com has the stats by the individual day. We will use this in our gambling model.
##Test with these.
```{r}
url <- "https://www.teamrankings.com/nba/stat/opponent-1st-quarter-points-per-game"

Lines <- readLines(url)
Lines.tib <- as.tibble(Lines)
Lines.text <- Lines.tib[1739:2055,]
schedule.team <- htmltab(Lines.text[[1]], which =1, rm_nodata_cols = F)

url <- "https://www.teamrankings.com/nba/stat/offensive-efficiency"

Lines <- readLines(url)
Lines.tib <- as.tibble(Lines)
Lines.text <- Lines.tib[1739:2055,]
schedule.team <- htmltab(Lines.text[[1]], which =1, rm_nodata_cols = F)
head(schedule.team)
```

##Now test a for loop to pull in multiple dates and bind them together
```{r}
DatesData <- read.csv("Dates To Scrape.csv")
DatesData$Date <- mdy(DatesData$Date)
URLData <- read.csv("Links to stats to scrape.csv")
URLData$URL <- paste0(URLData$URL, "?date=")
#DatesData <- DatesData[1:10,]
#URLData <- URLData[1:2,]

df.tib <- as.tibble()
for(i in 1:dim(URLData)[1]){
  url <- paste0(URLData$URL[i])
  url.df <- as.tibble()
  stats <- paste0(URLData$Stat[i])
  
  for(j in 1:dim(DatesData)[1]){
    url2 <- paste0(url, DatesData$Date[j])
    Lines <- readLines(url2)
    Lines.tib <- as.tibble(Lines)
    Lines.text <- Lines.tib[1739:2055,]
    schedule.team <- htmltab(Lines.text[[1]], which =1, rm_nodata_cols = F)
    schedule.team <- schedule.team %>% 
      mutate(Date = DatesData$Date[j]) %>% 
      mutate(Stats = stats)
    
    names(schedule.team)[3] <- "YTD"
    names(schedule.team)[8] <- "LastYear"
    head(schedule.team, 2)
    url.df <- bind_rows(url.df, schedule.team)
  }
  
  df.tib <- bind_rows(df.tib, url.df)
  
}

write.csv(df.tib, "statsonstats.csv")
```


##Clean the data and join it to the current games

```{r}
head(df.tib)

##Create a data frame which replicates the stat on the 
head(DatesData)
head(URLData)

NewData <- DatesData %>% 
  mutate()
temp <- df.tib %>% 
  
  
```



