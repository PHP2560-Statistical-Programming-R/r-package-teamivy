---
title: "NBA-Lisha"
output: html_document
---

#Load Libraries
```{r}
library(rvest)
library(dplyr)
library(pipeR)
library(knitr)
library(stringr)
library(htmltab)
library(tidyr)
```

#htmltab
```{r}
schedule_url<-"https://widgets.sports-reference.com/wg.fcgi?css=1&site=bbr&url=%2Fleagues%2FNBA_"
standing_url<-"https://www.basketball-reference.com/leagues/NBA_"
opgs_url<-"https://widgets.sports-reference.com/wg.fcgi?css=1&site=bbr&url=%2Fplayoffs%2FNBA_"
ops_url<-"https://widgets.sports-reference.com/wg.fcgi?css=1&site=bbr&url=%2Fplayoffs%2FNBA_"

#schedule
schedule_table<-function(year){
  if(year>2018){
    print("The season doesn't start")
  }else if(year<2001){
    print("The season isn't included")
  }else{
    if(year==2012){
    month=c("december","january","february",
          "march","april","may","june")
    }else{
    month=c("october","november","december","january","february",
          "march","april","may","june")
  result=NA
  for(a in 1:length(month)){
    url<-paste0(schedule_url,year,"_games-",month[a],".html&div=div_schedule")
    table<-htmltab(url)
    result=rbind(result,table)}
  result<-result %>% 
    drop_na() %>%
    filter(Date !="Playoffs")
  names(result)[3]<-"Visitor"
  names(result)[4]<-"PTSV"
  names(result)[5]<-"Home"
  names(result)[6]<-"PTSH"
  result$Date<-as.Date(result$Date, '%a, %b %d, %Y')
  result$PTSH<-as.numeric(result$PTSH)
  result$PTSV<-as.numeric(result$PTSV)
  return(result)
    }
  }
  }


schedule_2016<-schedule_table(2016)

a<-left_join(schedule_2017,NBAOdds20072018Update, by=c("Date", "Visitor","Home","PTSH","PTSV"))


#webscape standings for east or west conference and clean it.
webscrape_standings<-function(year,conference){
  url<-paste(standing_url,year,'_standings.html',sep="")
  table<-url %>% 
  read_html()%>% 
  html_nodes(paste0("#confs_standings_",conference)) %>% 
  html_table(header = T) %>%
  data.frame() %>%
  tbl_df()
  names(table)[1]<-"Team"
  table$Team<-gsub("[*(0-9)]","",table$Team)
  table$Team<-sub("\\s+$", "", table$Team)
  table$Team<-gsub(" ers"," 76ers", table$Team)
  return(table)
}

standings_west_2017<-webscrape_standings(2017,"W")
standings_east_2017<-webscrape_standings(2017,"E")

#opponent per game stats
opsg_table <- function(year){
  url<-paste0(opgs_url,year,".html&div=div_opponent-stats-per_game")
  table<-htmltab(url)
  return(table)
}

opsg<-opsg_table(2017)[-1]

#opponent shooting
ops_table<-function(year){
  url<-paste0(ops_url,year,".html&div=div_opponent_shooting")
  table<-htmltab(url)
  return(table)
}

ops<-ops_table(2017)[-1]

```

