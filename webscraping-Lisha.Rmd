---
title: "NBA-Lisha"
output: html_document
---

#Load Libraries
```{r}
library(rvest)
library(dplyr)
library(pipeR)
library(knitr)
library(stringr)
```

#Webscrape data
```{r}
http1 <- 'https://www.basketball-reference.com/teams/'
http2 <- 'https://www.basketball-reference.com/leagues/NBA_2017_'
http3 <- 'https://www.basketball-reference.com/playoffs/'

#Webscrape schedule according to month
webscrape_schedule<-function(month,css_page){
  a<-substitute(month)
  a<-as.character(a)
  url<-paste(http2,'games-',a,'.html',sep="")
  table<-url %>% 
  read_html()%>% 
  html_nodes(css_page) %>% 
  html_table(header = T) %>%
  data.frame() %>%
  tbl_df()
  return(table)
}

schedule<-webscrape_schedule(december,"#schedule")


#webscrape playoffs summary for specified year 
webscrape_playoffs<-function(year,css_page){
  url<-paste(http3,'NBA_',year,'.html',sep = "")
  print(url)
  table<-url %>% 
  read_html()%>% 
  html_nodes(css_page) %>% 
  html_table(header = T) %>%
  data.frame() %>%
  tbl_df()
  return(table)
}

OPGS_2017<-webscrape_playoffs(2017,"#team-stats-per_game")
#I can't pull opponents stats, always 0 variable?????

#websrape stats for each team and year
webscrape_team <- function(team,year,css_page){
  a<-substitute(team)
  a<-as.character(a)
  url<-paste(http1,a,"/",year,".html",sep="")
  table<-url %>% 
    read_html()%>% 
    html_nodes(css_page) %>% 
    html_table(header = T) %>%
    data.frame() %>%
    tbl_df()
  return(table)
}

GSW_2017<-webscrape_team(GSW,2017,"#roster")

```
#htmltab
```{r}
schedule_url<-"https://widgets.sports-reference.com/wg.fcgi?css=1&site=bbr&url=%2Fleagues%2FNBA_"
standing_url<-"https://www.basketball-reference.com/leagues/NBA_"
opgs_url<-"https://widgets.sports-reference.com/wg.fcgi?css=1&site=bbr&url=%2Fplayoffs%2FNBA_"
ops_url<-"https://widgets.sports-reference.com/wg.fcgi?css=1&site=bbr&url=%2Fplayoffs%2FNBA_"

#schedule
schedule_table<-function(year,month){
  url<-paste0(schedule_url,year,"_games-",month,".html&div=div_schedule")
  table<-htmltab(url)
  return(table)
}

November_2017<-schedule_table(2017,"november") 
names(November_2017)[3]<-"Visit team"
names(November_2017)[5]<-"Home team"

#webscape standings for east or west conference
webscrape_standings<-function(year,conference){
  url<-paste(standing_url,year,'_standings.html',sep="")
  table<-url %>% 
  read_html()%>% 
  html_nodes(paste0("#confs_standings_",conference)) %>% 
  html_table(header = T) %>%
  data.frame() %>%
  tbl_df()
  return(table)
}

standings_west_2017<-webscrape_standings(2017,"W")
standings_east_2017<-webscrape_standings(2017,"E")

names(standings_east_2017)[1]<-"Team"
names(standings_west_2017)[1]<-"Team"

standings_west_2017$Team<-gsub("[*(0-9)]","",standings_west_2017$Team)
standings_west_2017$Team<-sub("\\s+$", "", standings_west_2017$Team)
standings_west_2017$Team<-gsub(" ers"," 76ers",standings_west_2017$Team)

#opponent per game stats
opsg_table <- function(year){
  url<-paste0(opgs_url,year,".html&div=div_opponent-stats-per_game")
  table<-htmltab(url)
  return(table)
}

opsg<-opsg_table(2017)[-1]

#opponent shooting
ops_table<-function(year){
  url<-paste0(ops_url,year,".html&div=div_opponent_shooting")
  table<-htmltab(url)
  return(table)
}

ops<-ops_table(2017)[-1]

```

#clean data
```{r}
unicode_pattern <-"<U+00A0>"
standings_east$Eastern.Conference<-str_replace_all(standings_east$Eastern.Conference,unicode_pattern,replacement = "")
```

